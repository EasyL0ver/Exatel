#!/bin/bash
# Definir a senha de root
sudo passwd root

# Instalando o ansible para automatizar demais processos
apt update
apt upgrade -y
apt install sshpass python vim openssh-server -y

# Ativando o SSH
sed -i 's/#Port 22/Port 22/g' /etc/ssh/sshd_config
sed -i 's/#AddressFamily any/AddressFamily any/g' /etc/ssh/sshd_config
sed -i 's/#ListenAddress 0.0.0.0/ListenAddress 0.0.0.0/g' /etc/ssh/sshd_config
sed -i 's/#SyslogFacility AUTH/SyslogFacility AUTH/g' /etc/ssh/sshd_config
sed -i 's/#LogLevel INFO/LogLevel INFO/g' /etc/ssh/sshd_config
sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/g' /etc/ssh/sshd_config
sed -i 's/#MaxAuthTries 6/MaxAuthTries 6/g' /etc/ssh/sshd_config
systemctl restart sshd

# Criar chave ssh e configura para acesso
cat /dev/zero | ssh-keygen -q -N ""
cat /root/.ssh/id_rsa.pub > /root/.ssh/authorized_keys

# Configurando teclado
mv /etc/default/keyboard /etc/default/keyboard.bkp
echo 'XKBMODEL="thinkpad60" ' > /etc/default/keyboard
echo 'XKBLAYOUT="br" ' >> /etc/default/keyboard
echo 'XKBVARIANT="" ' >> /etc/default/keyboard
echo 'XKBOPTIONS="" ' >> /etc/default/keyboard
echo 'BACKSPACE="guess" ' >> /etc/default/keyboard

# Criando script para teste wireless
echo 'L=5000;SERVER="10.2.1.120";FILE="/tmp/fakeiso1.iso";DEST="/tmp";for (( i=1;;i++ )); do T=$(shuf -i1-60 -n1); echo -e "\niniciando download", time=$T; timeout $T scp -l $L $SERVER:$FILE $DEST ; echo -e "\nsleeping $i"; sleep $T; done' > /tmp/script-wire.sh