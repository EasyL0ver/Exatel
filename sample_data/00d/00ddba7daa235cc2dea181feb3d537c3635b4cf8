using System;
using System.Data.SQLite;
using System.IO;

namespace CursApp.Library
{
    public class LogDB
    {
        private readonly string fileName = "log.db";
        private SQLiteConnection connection;
        private SQLiteCommand command;
        private static LogDB _instance;

        private LogDB()
        {
            string path = string.Format("{0}\\{1}", AppDomain.CurrentDomain.BaseDirectory, fileName);

            if (!File.Exists(path))
            {
                SQLiteConnection.CreateFile(path);
            }

            connection = new SQLiteConnection("Data Source=" + path + ";Version=3;");
            command = new SQLiteCommand(connection);
            connection.Open();

            command.CommandText = "CREATE TABLE IF NOT EXISTS Logs (id INTEGER PRIMARY KEY AUTOINCREMENT, date TEXT, message TEXT)";
            command.ExecuteNonQuery();

        }

        public static LogDB GetInstance()
        {
            if (_instance == null)
            {
                _instance = new LogDB();
            }

            return _instance;
        }

        public void WriteToDB(string message)
        {
            command.CommandText = $"INSERT INTO Logs ('date', 'message') VALUES ('{DateTime.Now.ToString()}', '{message}')";
            command.ExecuteNonQuery();
        }
    }
}