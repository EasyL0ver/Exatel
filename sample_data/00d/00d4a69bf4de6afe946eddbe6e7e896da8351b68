package syntechbd.com.posspot;

import android.database.Cursor;
import android.database.sqlite.SQLiteDatabase;
import android.os.Bundle;
import android.support.v4.app.Fragment;
import android.text.Editable;
import android.text.TextUtils;
import android.text.TextWatcher;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.Button;
import android.widget.CompoundButton;
import android.widget.EditText;
import android.widget.LinearLayout;
import android.widget.RelativeLayout;
import android.widget.Spinner;
import android.widget.Switch;
import android.widget.TextView;

import com.android.volley.DefaultRetryPolicy;
import com.android.volley.Request;
import com.android.volley.RequestQueue;
import com.android.volley.Response;
import com.android.volley.RetryPolicy;
import com.android.volley.VolleyError;
import com.android.volley.toolbox.StringRequest;
import com.android.volley.toolbox.Volley;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

import java.text.DecimalFormat;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import syntechbd.com.posspot.app.DBHelper;
import syntechbd.com.posspot.modal.SalesInfoModal;


public class FragmentPayment extends Fragment {

    Spinner paymentBySpinner, CardTypeSpinner, BankTypeSpinner, MobileBankSpinnerSP;

    TextView cashTXT, cardNoTXT, cardPayTXT, cardTypeTXT, BankNameTV, TOTAL_AMMOUNT_TXT;
    TextView AmountMobileTV, MobileBankSpinnerTV, TransactionNoTV, ReceiverNoTV;
    TextView PaidAmountTextView, DueAmountTextView, RoundAmountTextView;

    TextView showMessageTV;

    EditText AmountMobileET, TransactionNoET, ReceiverNoET;
    EditText cashEDT, cardNoEDT, cardPayET;


    RelativeLayout CardTypeSpinnerLayout, BankTypeSpinnerLayout, MobileBankTypeSpinnerLayout;

    LinearLayout PaymentOptionLayoutLW,totalAmountLW,textEDtHolderLW;

    Switch round;

    ArrayList<String> pamentBYList = new ArrayList<>();
    ArrayList<String> cardTypeList = new ArrayList<>();

    ArrayList<String> BankList = new ArrayList<>();
    ArrayList<String> MobileBankList = new ArrayList<>();

    ArrayList<String> BankDetails = new ArrayList<>();
    ArrayList<String> MobileBankDetails = new ArrayList<>();
    ArrayList<SalesInfoModal> salesInfoModals =  new ArrayList<>();
    ArrayList<SalesInfoModal> salesInfoModals2 =  new ArrayList<>();


    private String bank_id, acc_type_id, bank_name, id_account, account_no;
    private String cashEDText;
    private String FinallyAmountPaidInCashEDT;
    private String GrandTotalToPay="0";

    private String cash;
    private String cash_acc_id = "1";


    Button GenGrandTotalBTN,SaleNowBTN;

    DBHelper db;
    private int NumOfRow;


    public FragmentPayment() {
        // Required empty public constructor
    }


    @Override
    public View onCreateView(LayoutInflater inflater, ViewGroup container,
                             Bundle savedInstanceState) {
        // Inflate the layout for this fragment

        View v = inflater.inflate(R.layout.fragment_payment, container, false);


        loadAutoSuggestionDataForBANKtype("http://dpos.posspot.com/api/sales_api/bank_name_all", "1");

        paymentBySpinner = (Spinner) v.findViewById(R.id.paymentTypeSP);
        CardTypeSpinner = (Spinner) v.findViewById(R.id.cardTypeSp);
        cashTXT = (TextView) v.findViewById(R.id.cashTV);
        cashEDT = (EditText) v.findViewById(R.id.cashInTakaET);

        cardNoTXT = (TextView) v.findViewById(R.id.cardNumberTV);
        cardNoEDT = (EditText) v.findViewById(R.id.cardNumET);

        cardPayTXT = (TextView) v.findViewById(R.id.cardPayTV);
        cardPayET = (EditText) v.findViewById(R.id.cardPayET);

        BankNameTV = (TextView) v.findViewById(R.id.BankNameTV);
        BankTypeSpinner = (Spinner) v.findViewById(R.id.bankTypeSp);

        AmountMobileTV = (TextView) v.findViewById(R.id.AmountMobileTV);
        AmountMobileET = (EditText) v.findViewById(R.id.AmountMobileET);

        MobileBankSpinnerTV = (TextView) v.findViewById(R.id.MobileBankSpinnerTV);
        MobileBankSpinnerSP = (Spinner) v.findViewById(R.id.MobileBankSpinnerSP);

        TransactionNoTV = (TextView) v.findViewById(R.id.TransactionNoTV);
        TransactionNoET = (EditText) v.findViewById(R.id.TransactionNoET);

        ReceiverNoTV = (TextView) v.findViewById(R.id.ReceiverNoTV);
        ReceiverNoET = (EditText) v.findViewById(R.id.ReceiverNoET);

        cardTypeTXT = (TextView) v.findViewById(R.id.cardTypeTV);
        TOTAL_AMMOUNT_TXT = (TextView) v.findViewById(R.id.totalAmountTV);


        PaidAmountTextView = (TextView) v.findViewById(R.id.paidAmountTV);
        RoundAmountTextView = (TextView) v.findViewById(R.id.roundAmountTV);
        DueAmountTextView = (TextView) v.findViewById(R.id.totalDueTV);

        CardTypeSpinnerLayout = (RelativeLayout) v.findViewById(R.id.CardTypeSpinnerLayoutID);
        BankTypeSpinnerLayout = (RelativeLayout) v.findViewById(R.id.bankTypeSpLayoutID);
        MobileBankTypeSpinnerLayout = (RelativeLayout) v.findViewById(R.id.MobilebankTypeSpLayoutID);
        GenGrandTotalBTN = (Button) v.findViewById(R.id.GenGrandTotalBTN);
        SaleNowBTN = (Button) v.findViewById(R.id.SaleNowBTN);

        totalAmountLW = (LinearLayout) v.findViewById(R.id.totalAmountLW);
        textEDtHolderLW = (LinearLayout) v.findViewById(R.id.textEDtHolderLW);
        PaymentOptionLayoutLW = (LinearLayout) v.findViewById(R.id.PaymentOptionLayoutLW);

        showMessageTV = (TextView) v.findViewById(R.id.showMSG);



        round = (Switch) v.findViewById(R.id.roundSW);

        totalAmountLW.setVisibility(View.GONE);
        textEDtHolderLW.setVisibility(View.GONE);
        PaymentOptionLayoutLW.setVisibility(View.GONE);

        pamentBYList.add(0, "Cash");
        pamentBYList.add(1, "Card");
        pamentBYList.add(2, "Mobile");

        cardTypeList.add(0, "Select One");
        cardTypeList.add(1, "Amex");
        cardTypeList.add(2, "Mastercard");
        cardTypeList.add(3, "Nexus");
        cardTypeList.add(4, "Visa");

        ArrayAdapter<String> paymentByAdapter = new ArrayAdapter<String>(getContext(), android.R.layout.simple_spinner_item, pamentBYList);
        paymentByAdapter.setDropDownViewResource(android.R.layout.simple_list_item_single_choice);
        paymentBySpinner.setAdapter(paymentByAdapter);
        paymentBySpinner.setSelection(0);

        ArrayAdapter<String> cardTypeAdapter = new ArrayAdapter<String>(getContext(), android.R.layout.simple_spinner_item, cardTypeList);
        cardTypeAdapter.setDropDownViewResource(android.R.layout.simple_list_item_single_choice);
        CardTypeSpinner.setAdapter(cardTypeAdapter);
        CardTypeSpinner.setSelection(0);



        GenGrandTotalBTN.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {

                db = new DBHelper(getContext());
                GrandTotalToPay = db.getGrandTotal(1).trim();
                GenGrandTotalBTN.setVisibility(View.GONE);
                SaleNowBTN.setVisibility(View.VISIBLE);
                totalAmountLW.setVisibility(View.VISIBLE);
                textEDtHolderLW.setVisibility(View.VISIBLE);
                PaymentOptionLayoutLW.setVisibility(View.VISIBLE);
                TOTAL_AMMOUNT_TXT.setText(String.valueOf(GrandTotalToPay));
                DueAmountTextView.setText(String.valueOf(GrandTotalToPay));

                salesInfoModals= db.getOverviewList2();
                salesInfoModals2 = db.getOverviewList3();


            }
        });


        cashEDT.addTextChangedListener(new TextWatcher() {

            @Override
            public void afterTextChanged(Editable s) {
                if (TextUtils.isEmpty(cashEDText)) {
                    cashEDText = "0";
                }


                FinallyAmountPaidInCashEDT = new DecimalFormat("##.##").format(Double.valueOf(cashEDText));

                PaidAmountTextView.setText(FinallyAmountPaidInCashEDT);
                DueAmountTextView.setText(String.valueOf(Double.valueOf(GrandTotalToPay) - Double.valueOf(FinallyAmountPaidInCashEDT)));


            }

            @Override
            public void beforeTextChanged(CharSequence s, int start,
                                          int count, int after) {
            }

            @Override
            public void onTextChanged(CharSequence s, int start,
                                      int before, int count) {

                cashEDText = cashEDT.getText().toString();


            }
        });
        cardPayET.addTextChangedListener(new TextWatcher() {

            @Override
            public void afterTextChanged(Editable s) {
                if (TextUtils.isEmpty(cashEDText)) {
                    cashEDText = "0";
                }


                FinallyAmountPaidInCashEDT = new DecimalFormat("##.##").format(Double.valueOf(cashEDText));

                PaidAmountTextView.setText(FinallyAmountPaidInCashEDT);
                DueAmountTextView.setText(String.valueOf(Double.valueOf(GrandTotalToPay) - Double.valueOf(FinallyAmountPaidInCashEDT)));


            }

            @Override
            public void beforeTextChanged(CharSequence s, int start,
                                          int count, int after) {
            }

            @Override
            public void onTextChanged(CharSequence s, int start,
                                      int before, int count) {

                cashEDText =