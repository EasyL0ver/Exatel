#include <iostream>
#include <cstdlib>
#include <fstream>
#include <sstream>

using namespace std;
struct przepis{
    int numer;
    string nazwa;
    int czas;
    int ile_potrzebnych;
    int ile_niepotrzebnych;
    string skladnik_potrzebnych[50];
    string skladnik_niepotrzebny[50];
    string opis;
    };

void nazwa_programu(){
    cout<<char(201);
    for(int i=0;i<17;i++) cout<< char(205);
    cout<<char(187)<<endl;
    cout<<char(186)<<"Ksiazka kucharska" << char(186)<<endl;
    cout << char(200);
    for(int i=0;i<17;i++)
    cout<< char(205);
    cout<<char(188) << endl;
    return;
    }

void spr(){
    if(cin.fail())
        {
        cin.clear();
        char c;
        cin>>c;
        }
    return;
    }

int ile_spacji (string linia){
    int spacja=0;
    int dlugosc;
    dlugosc = linia.length();
    for (int i=0; i<dlugosc;i++){
        if(linia[i]==char(32)) spacja++;
        }
    return spacja;
    }

string* dzielenie(string linia, int &len){
    len=ile_spacji(linia)+1;
    string* split_string=new string[len];
    int j=0;
    stringstream new_line;
    for(int i=0;i<linia.length();i++){
        if(linia[i]==char(32)){
            split_string[j++]=new_line.str();
            new_line.str("");
            }
        else{
            new_line<<linia[i];
            }
        }
    split_string[j++]=new_line.str();
    new_line.str("");
    return split_string;
    }

void wczytaj(przepis ksiazka_kucharska[],int liczba_przepisow){
    ifstream from_file;
    from_file.open("ksiazka_kucharska.txt");
    if(!from_file){
        cout << "blad";
        return;
    }
    int spacje;
    int dlugosc_lini;
    int numer_tablicy=0;
    int numer_literki=0;
    string linia;
    int numer_lini=1;
    while (getline(from_file,linia)){
        int numer_przepisu=numer_lini%8;
        int komorka_tablicy=numer_lini/8;
        if(numer_przepisu==1){ksiazka_kucharska[komorka_tablicy].numer=atoi(linia.c_str());}
        if(numer_przepisu==2){ksiazka_kucharska[komorka_tablicy].nazwa=linia;}
        if(numer_przepisu==3){ksiazka_kucharska[komorka_tablicy].czas=atoi(linia.c_str());}
        if(numer_przepisu==4){ksiazka_kucharska[komorka_tablicy].ile_potrzebnych=atoi(linia.c_str());}
        if(numer_przepisu==5){ksiazka_kucharska[komorka_tablicy].ile_niepotrzebnych=atoi(linia.c_str());}
        if(numer_przepisu==6) {
                spacje=ile_spacji(linia);
                for (int i=0; i<spacje;i++){
                    ksiazka_kucharska[komorka_tablicy].skladnik_potrzebnych[i]=dzielenie(linia,spacje)[i];
                    }
                }
        if(numer_przepisu==7){
            spacje=ile_spacji(linia);
                for (int i=0; i<spacje;i++){
                    ksiazka_kucharska[komorka_tablicy].skladnik_niepotrzebny[i]=dzielenie(linia,spacje)[i];
                    }
                }

        if(numer_przepisu==0){ksiazka_kucharska[komorka_tablicy-1].opis=linia;}
        numer_lini++;
        }



    from_file.close();
    return;
    }

void wpisz(przepis ksiazka_kucharska[], int liczba_przepisow){
    int numer=0;
    string nazwa;
    int czas;
    int ile_potrzebnych;
    int ile_niepotrzebnych;
    string skladnik_potrzebnych;
    string skladnik_niepotrzebny;
    string opis;

    string linia;
    int licznik=0;
    ifstream from_file;
    from_file.open("ksiazka_kucharska.txt");

    if(!from_file){
        cout << "blad";
        return;
    }

    while (getline(from_file,linia)){
        licznik++;
        numer=licznik/8+1;
        }

    from_file.close();

    ofstream to_file;

    system("cls");
    to_file.open("ksiazka_kucharska.txt", ios::app);
    to_file<<"\n" << numer;
    cout<< "podaj nazwe przepisu: "<< endl;
    cin >>nazwa;
    to_file<<"\n"<<nazwa;
    system("cls");
    cout<< "podaj czas gotowania: "<< endl;
    while (true){
        cin >> czas;
        if(czas>0) break;
        else cout <<endl << "podana wartosc nie jest wieksza od zera lub nie jest liczba: ";
        spr();
        }
    to_file<<"\n"<<czas;
    system("cls");
    cout<< "podaj ile jest potrzebnych przepisow : "<< endl;
    while (true){
        cin >> ile_potrzebnych;
        if(ile_potrzebnych>0) break;
        else cout <<endl << "podana wartosc nie jest wieksza od zera lub nie jest liczba: ";
        spr();
        }
    to_file<<"\n"<<ile_potrzebnych;
    system("cls");
    cout<< "podaj ile jest nie potrzebnych przepisow : "<< endl;
    while (true){
        cin >> ile_niepotrzebnych;
        if(ile_niepotrzebnych>0) break;
        else cout <<endl << "podana wartosc nie jest wieksza od zera lub nie jest liczba: ";
        spr();
        }
    to_file<<"\n"<<ile_niepotrzebnych;
    system("cls");
    cout << "podaj potrzebne przyprawy po spacji: "<< endl;
    cin.sync();
    getline(cin, skladnik_potrzebnych);
    to_file<<"\n"<<skladnik_potrzebnych;
    system("cls");
    cout << "podaj przyprawy nie konieczne po spacji: "<< endl;
    cin.sync();
    getline(cin, skladnik_niepotrzebny);
    to_file<<"\n"<<skladnik_niepotrzebny;
    system("cls");
    cout << "podaj sposob przygotowania: "<< endl;
    cin.sync();
    getline(cin, opis);
    to_file<<"\n"<<opis;
    system("cls");

    to_file.close();
    return;
    };

void wypisz(int numerek, przepis ksiazka_kucharska[]){
    numerek-=1;
    cout << "numer przepisu : " << ksiazka_kucharska[numerek].numer <<endl;
    cout << "nazwa przepisu : " << ksiazka_kucharska[numerek].nazwa <<endl;
    cout << "czas przygotowania przepisu : " << ksiazka_kucharska[numerek].czas << " minut" << endl;
    cout << "potrzebne skladniki : ";
        for (int i=0; i<50; i++){
            cout<< ksiazka_kucharska[numerek].skladnik_potrzebnych[i] <<" ";
            }

    cout << endl <<"niepotrzebne skladniki : ";
        for (int i=0; i<50; i++){
            cout<< ksiazka_kucharska[numerek].skladnik_niepotrzebny[i] <<" ";
            }
    cout << endl <<"opis przygotowania: " << ksiazka_kucharska[numerek].opis <<endl;

}

void wyswietl_numer(int ile, przepis ksiazka_kucharska[]){
    int licznik;
    string temp;
    ifstream from_file;
    from_file.open("ksiazka_kucharska.txt");

    if(!from_file){
        cout << "blad";
        return;
    }
    while(getline(from_file,temp))licznik++;
    if (licznik/8<ile){
        system("cls");
        cout << "nie ma tylu przepisow :("<< endl;
        system("pause");
        return;
    }
    else{system("cls"); wypisz(ile, ksiazka_kucharska);}
    system("pause");

    return;
    };



int main()
{
string linia, nazwa_przepisu, skladniki;
int wybor, wybor2, ile;
int liczba_przepisow=0;
bool dzialanie=true;
bool czy_jest=false;

while(dzialanie){
    system("cls");
    ifstream from_file;
    from_file.open("ksiazka_kucharska.txt");

    if(!from_file){
        cout << "blad";
        return 0;
    }

    while (getline(from_file, linia)) liczba_przepisow++;

    liczba_przepisow=liczba_przepisow/8;
    przepis *ksiazka_kucharska=new przepis[liczba_przepisow];
    from_file.close();

    wczytaj(ksiazka_kucharska, liczba_przepisow);

    nazwa_programu();
    cout<< "Co chcesz zrobic?"<< endl;
    cout<< "1 : Wpisz nowy przepis"<< endl;
    cout<< "2 : Szukaj przepisu po numerze"<< endl;
    cout<< "3 : Szukaj przepisu po skladnikach"<< endl;
    cout<< "4 : Szukaj przepisu po nazwie"<< endl;
    cout<< "5 : Koniec"<< endl;
    while (true){
        cin >> wybor;
        if(wybor>0&&wybor<6) break;
        else cout <<endl << "podana wartosc nie zawiera sie miedzy 1 a 5 lub nie jest liczba sprobuj jeszcze raz: ";
        spr();
        }
        switch( wybor ){
            case 1:
                wpisz(ksiazka_kucharska, liczba_przepisow);
                break;

            case 2:
                system("cls");
                cout << "Podaj numer przepisu ktory chcesz wyswietlic: ";

                while (true){
                    cin >> ile;
                    if(ile>0) break;
                    else cout <<endl << "podana wartosc nie jest wieksza od zera lub nie jest liczba: ";
                    spr();
                    }
                wyswietl_numer(ile,ksiazka_kucharska);
                break;
            case 3:
                system("cls");
                cout << "Jakie skladniki ma zawiera przepis docelowy : " << endl;
                cout << "1.Sol"<<endl;
                cout << "2.Pieprz"<<endl;
                cout << "3.Kurczak"<<endl;
                cout << "4.Czosnek"<<endl;
                cout << "5.Ser"<<endl;
                cout << "6.Podaj swoj skladnik"<<endl;
                cout << "7.Zakoncz podawanie skladnikow"<<endl;
                cin >> wybor2;
                if (wybor2==1){skladniki+="sol"; cout<<skladniki;system("pause");}
                if (wybor2==2){skladniki+="pieprz";}
                if (wybor2==3){skladniki+="kurczak";}
                if (wybor2==4){skladniki+="czosnek";}
                if (wybor2==5){skladniki+="ser";}
                if (wybor2==6){skladniki+="sol";}
                if (wybor2==7){}


                break;
            case 4:
                system("cls");
                cout << "Podaj nazwe przepisu ktory chcesz wyswietlic: ";
                cin.sync();
                getline(cin, nazwa_przepisu);
                system("cls");
                for (int i=0; i<liczba_przepisow;i++){
                       if (ksiazka_kucharska[i].nazwa==nazwa_przepisu){
                                wypisz(i+1, ksiazka_kucharska);
                                czy_jest=true;
                                system("pause");
                            }

                    }
               