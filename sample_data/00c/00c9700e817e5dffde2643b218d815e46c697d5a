def city_state_result(request, city, state, what):
    qs = search_location = search_term = subcategories = neighborhoods = None

    if city and state:
        search_location = ', '.join([city,state])
        qs = Location.objects.filter(city__iexact=city, state__iexact=state)
        neighborhoods = nearby_neighborhoods(city=city,state=state)
        title = '%s, %s %s Coupons' % (city, state, what)
        meta = 'Find %s Coupons in %s, %s on WebCoupons.com.  Maps, phone numbers, addresses, driving directions, reviews and more on WebCoupons.com' % (what, city, state)
        set_user_location_for_ip(request, search_location)
        # set last city, state session list if it doesn't exist
        request.session.setdefault('last_city_state', [])
        # if city,state not in list, add it
        if city + ", " + state not in request.session['last_city_state']:
            if len(request.session['last_city_state']) >= 5:
                request.session['last_city_state'].pop()
            request.session['last_city_state'].insert(0, city + ", " + state)
    elif state:
        search_location = state
        qs = Location.objects.filter(state__iexact=state)
        neighborhoods = nearby_neighborhoods(state=state)
        title = '%s Coupons & Business Directory' % state
        meta = 'Find the best coupons and deals in %s.' % state
        set_user_location_for_ip(request, search_location)
        # set last state session list if it doesn't exist
        request.session.setdefault('last_state', [])
        # if state not in list, add it
        if state not in request.session['last_state']:
            if len(request.session['last_state']) >= 5:
                request.session['last_state'].pop()
            request.session['last_state'].insert(0, state)

    subcategories = zipcodes_for_city(city,state)
    if len(subcategories) < 2:
        subcategories = nearby_cities(city, state)

    ## qs = qs.filter(**parse_what(what))
    qs = add_what_query(qs, what)
    return search_result(request, qs, search_location, what, subcategories, neighborhoods)