#include <iostream>
#include <stdlib.h>
#include <windows.h>
#include <vector>
#include <conio.h>

bool zmr1;
bool zmr2;
bool zmr3;


void LFSR_R1(bool tab[19]){
    bool R1last=((tab[0]^tab[1])^tab[2])^tab[5];
    for(int i=0;i<18;i++){
        tab[i]=tab[i+1];
    }
    tab[18]=R1last;
}

void LFSR_R2(bool tab[22]){
    bool R2last=tab[0]^tab[1];
    for(int i=0;i<21;i++){
        tab[i]=tab[i+1];
    }
    tab[21]=R2last;
}

void LFSR_R3(bool tab[23]){
    bool R3last=((tab[0]^tab[1])^tab[2])^tab[15];
    for(int i=0;i<22;i++){
        tab[i]=tab[i+1];
    }
    tab[22]=R3last;
}

bool get_keystream(){
 return (zmr1^zmr2)^zmr3;
}

void cycle(bool R1[19], bool R2[22], bool R3[23]){
 if((R1[10]==0)&&(R2[11]==0)&&(R3[12]==0)){
        LFSR_R1(R1); LFSR_R2(R2); LFSR_R3(R3);
    }
    else if((R1[10]==0)&&(R2[11]==0)&&(R3[12]==1)){
        LFSR_R1(R1); LFSR_R2(R2);
    }
    else if((R1[10]==0)&&(R2[11]==1)&&(R3[12]==0)){
        LFSR_R1(R1); LFSR_R3(R3);
    }
    else if((R1[10]==0)&&(R2[11]==1)&&(R3[12]==1)){
        LFSR_R2(R2); LFSR_R3(R3);
    }
    else if((R1[10]==1)&&(R2[11]==0)&&(R3[12]==0)){
        LFSR_R2(R2); LFSR_R3(R3);
    }
    else if((R1[10]==1)&&(R2[11]==0)&&(R3[12]==1)){
        LFSR_R1(R1); LFSR_R3(R3);
    }
    else if((R1[10]==1)&&(R2[11]==1)&&(R3[12]==0)){
        LFSR_R1(R1); LFSR_R2(R2);
    }
    else if((R1[10]==1)&&(R2[11]==1)&&(R3[12]==1)){
        LFSR_R1(R1); LFSR_R2(R2); LFSR_R3(R3);
    }
}

void myprint(bool R1[19], bool R2[22], bool R3[23]){
        HANDLE hConsole = GetStdHandle(STD_OUTPUT_HANDLE);
    std::cout << "R1:[";
    for(int i=0;i<10;i++)
    {
        std::cout << R1[i] <<", ";
    }
    SetConsoleTextAttribute(hConsole, 10);
    std::cout << R1[10] << ", ";
    SetConsoleTextAttribute(hConsole, 7);
        for(int i=11;i<18;i++)
    {
        std::cout << R1[i] <<", ";
    }
    std::cout << R1[18] << "]" << std::endl;


    std::cout << "R2:[";
    for(int i=0;i<11;i++)
     {
        std::cout << R2[i] <<", ";
    }
    SetConsoleTextAttribute(hConsole, 10);
    std::cout << R2[11] << ", ";
    SetConsoleTextAttribute(hConsole, 7);
        for(int i=12;i<21;i++)
    {
        std::cout << R2[i] <<", ";
    }
    std::cout << R2[21] << "]" << std::endl;


    std::cout << "R3:[";
    for(int i=0;i<12;i++)
        {
        std::cout << R3[i] <<", ";
    }
    SetConsoleTextAttribute(hConsole, 10);
    std::cout << R3[12] << ", ";
    SetConsoleTextAttribute(hConsole, 7);
        for(int i=13;i<22;i++)
    {
        std::cout << R3[i] <<", ";
    }
    std::cout << R3[22] << "]" << std::endl;



}



int main()
{
bool R1[19]={1,0,1,1,1,0,1,0,0,0,1,0,1,0,1,1,0,0,1};
bool R2[22]={1,1,0,1,0,0,1,0,0,0,0,0,1,0,1,0,1,1,0,1,0,1};
bool R3[23]={0,0,0,1,0,1,1,0,1,1,1,0,0,1,0,1,0,1,0,1,1,1,1};

    zmr1=R1[0];
    zmr2=R2[0];
    zmr3=R3[0];


//std::cout<<"Keystream = "<<std::endl;




         std::vector < bool > array;
            myprint(R1, R2, R3);
            bool n=get_keystream();
            array.push_back( n );
            std::cout << "Keystream:";
            for( size_t i = 0; i < array.size(); i++ )
         std::cout << array[ i ];
         std::cout << std::endl<<std::endl;
       //  bool n;
         bool l=0;
    while(1){

    getch();

        cycle(R1, R2, R3);
            myprint(R1, R2, R3);
                zmr1=R1[0];
                zmr2=R2[0];
                zmr3=R3[0];


            n=get_keystream();
            array.push_back( n );
            std::cout << "Keystream:";
            for( size_t i = 0; i < array.size(); i++ )
         std::cout << array[ i ];
         std::cout << std::endl << std::endl;
}






    return 0;
}