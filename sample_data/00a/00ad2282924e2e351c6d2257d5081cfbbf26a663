package testowy;

import java.sql.Connection;
import java.sql.DatabaseMetaData;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.Properties;



public class TestDB {

	public static void main(String[] args) throws SQLException {
		
		try {
			 Class.forName("com.mysql.jdbc.Driver");
			} catch (ClassNotFoundException e) {
			  System.err.println("Brak sterownika: " + e.getMessage());
			  System.exit(1);
			}
		String host = "localhost";
		String dbName = "test4";
		int port = 3306;
		String mySqlUrl = "jdbc:mysql://" + host + ":" + port + "/" + dbName 
			+ "?serverTimezone=UTC&useSSL=false" ;

		Connection connection = null;
		try {
			 Properties userInfo = new Properties();
			 userInfo.put("user", "root");
			 userInfo.put("password", "marcin06");
			 connection =
			     DriverManager.getConnection(mySqlUrl, userInfo);
			} catch (SQLException e) {
			  System.err.println("Blad polaczenia: " + e.getMessage());
			}

		
		DatabaseMetaData dbMetaData = connection.getMetaData();

		String productName = dbMetaData.getDatabaseProductName();
		System.out.println("Database: " + productName);

		String productVersion = dbMetaData.getDatabaseProductVersion();
		System.out.println("Version: " + productVersion);

		
		Statement statement = connection.createStatement();

		/*
		String query = "INSERT INTO kontakty (nazwisko, imie, email, telefon)" +
					" VALUES ('Adamski', 'Adam', 'adam@adam.pl', 1231434)";
		
		int liczba = statement.executeUpdate(query);
		System.out.println("Dodano wierszy: " + liczba);
		*/
		
		String query = "SELECT * FROM kontakty ";
		
		ResultSet wynik = statement.executeQuery(query); 
		
		while ( wynik.next() ) {
			
			int id = wynik.getInt("id");
			String nazwisko = wynik.getString("nazwisko");
			String imie = wynik.getString("imie");
			System.out.println( wynik.getRow() + " " + id + " " + nazwisko + " " + imie );
		}
		wynik.last();
		System.out.println( "Liczba rekordow: " + wynik.getRow() );
		System.out.println( wynik.getMetaData().getColumnCount() + " "
				+ wynik.getMetaData().getColumnName(3) + " " +
				wynik.getMetaData().getColumnTypeName(3) + " " 
				);
		
		
		statement.close();
		
		
		PreparedStatement pdst = 
				 connection.prepareStatement(
				  "insert into kontakty (imie, nazwisko, email, telefon) values (?, ?, ?, ?)");

				pdst.setString(1, "Jan");
				pdst.setString(2, "Kowalski");
				pdst.setString(3, "jan@kowalski.pl");
				pdst.setString(4, "123123123");
				pdst.executeUpdate();

				pdst.setString(1, "Adam");
				pdst.setString(2, "Nowak");
				pdst.setString(3, "jan@kowalski.pl");
				pdst.setString(4, "123123123");
				pdst.executeUpdate();

				pdst.close();

		
		
		//String query = "SELECT indeks, imie, nazwisko FROM studenci";
		//ResultSet resultSet = statement.executeQuery(query);


	}

}