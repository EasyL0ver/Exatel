package bugreport;

import java.io.BufferedWriter;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.text.SimpleDateFormat;
import java.util.Date;

import org.bukkit.command.Command;
import org.bukkit.command.CommandExecutor;
import org.bukkit.command.CommandSender;
import org.bukkit.plugin.java.JavaPlugin;
import org.json.simple.JSONObject;

public class BugReport extends JavaPlugin implements CommandExecutor {
	private String dane="",loc=System.getProperty("user.dir");
	private Date now;
	private SimpleDateFormat format = new SimpleDateFormat("dd-mm-yyyy HH:mm:ss");
	private BufferedWriter out;
	@Override
    public void onEnable() 
	{
		File dir = new File(loc + "\\plugins\\BugReport");
    	if (!dir.exists()) 
    	{
    	    System.out.println("[BugReport] Creating directory: " + dir.getName());
    	    boolean result = false;

    	    try
    	    {
    	        dir.mkdir();
    	        result = true;
    	    } 
    	    catch(SecurityException se)
    	    {
    	    	
    	    }        
    	    if(result) 
    	    {    
    	        System.out.println("[BugReport] DIR created");  
    	    }
    	}
    }
	@Override
    public boolean onCommand(CommandSender sender, Command command, String label, String[] args)
	{
        if (command.getName().equalsIgnoreCase("bug"))
        {
        	for (int i = 0; i < args.length; i++) 
        	{
        		dane+=args[i];
        		dane+=" ";
			}
        	now = new Date();
        	JSONObject report = new JSONObject();
        	report.put("Time", format.format(now));
        	report.put("Player", sender.getName());
        	report.put("Message",dane);
        	FileWriter file = null;
			try 
			{
				file = new FileWriter(loc + "\\plugins\\BugReport\\dane.json", true);
				out = new BufferedWriter(file);
				out.write(report.toJSONString()+"\n");
				out.close();
        		System.out.println("Zapisano Report o bugu!");
        		sender.sendMessage("Twoje zgłoszenie zostało zapisane!");
			} 
			catch (IOException e) 
			{
				System.out.println(e);
				e.printStackTrace();
			}
        } 
        dane="";
        return true;

	}

}