{-# LANGUAGE OverloadedStrings #-}
import qualified Data.ByteString.Lazy as B
import Data.Char
import Network.Wai
import Network.Wai.Handler.CGI (run)
import Network.Wai.Middleware.Gzip (gzip, def)
import Network.HTTP.Types (status200)

application _ = return $ responseLBS status200 [("Content-Type", "text/plain")]
                       content
  where
    content = B.pack $ map (fromIntegral . ord) $ concat $ ["BEGIN"] ++ map show [1..100000] ++ ["END"]

main = run $ gzip def application
--main = run $          application

-- This can be executed by `REMOTE_ADDR=localhost HTTP_ACCEPT_ENCODING=gzip runghc test_with_cgi.hs'.