/*
KREIRANJE PICKUPOVA SA DIALOGOM - by Xalazy Script
*/

//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~// Include
#include <a_samp>
#include <streamer>
#include <YSI\y_commands>
#include <YSI\y_INI>
//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~// Define
#define dialog_CREATEPICKUP 1
#define SPD ShowPlayerDialog
#define ORANGE "{FFAF00}"
//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~// Kreiranje Pickupova
#define MAX_PICKUPOVA 500
#define PICKUPS_FILE "/Pickups/%d.ini"

enum PickupsInfo
{
	pPickupID,
	Float:PickupX,
	Float:PickupY,
	Float:PickupZ
}
new PickupInfo[MAX_PICKUPOVA][PickupsInfo], if_pickup_created;
//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~// Ucitavanje Pickupova
public OnGameModeInit() {
    for(new _p_id_ = 0; _p_id_ < MAX_PICKUPOVA; _p_id_++)
	{
        new pickups_file[50];
        format(pickups_file, sizeof(pickups_file), PICKUPS_FILE, _p_id_);
        if(fexist(pickups_file))
		{
            INI_ParseFile(pickups_file, "ucitaj_pickupove", .bExtra = true, .extra = _p_id_);
  		    if_pickup_created = CreateDynamicPickup(PickupInfo[_p_id_][pPickupID], 1, PickupInfo[_p_id_][PickupX], PickupInfo[_p_id_][PickupY], PickupInfo[_p_id_][PickupZ]);
		}
	}
	return true;
}
//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~// Za Dialog
public OnDialogResponse(playerid, dialogid, response, listitem, inputtext[]) {
    if(dialogid == dialog_CREATEPICKUP) {
		if(!response) return true;
		if(response) {
		    new Float:pos_X, Float:pos_Y, Float:pos_Z;
      		GetPlayerPos(playerid, pos_X, pos_Y, pos_Z);
	        if_pickup_created = CreateDynamicPickup(PickupInfo[if_pickup_created][pPickupID], 1, PickupInfo[if_pickup_created][PickupX], PickupInfo[if_pickup_created][PickupY], PickupInfo[if_pickup_created][PickupZ], 0);
            PickupInfo[if_pickup_created][pPickupID] = strval(inputtext);
      		PickupInfo[if_pickup_created][PickupX] = pos_X;
	        PickupInfo[if_pickup_created][PickupY] = pos_Y;
	        PickupInfo[if_pickup_created][PickupZ] = pos_Z;
			SacuvajPickupove(if_pickup_created);
		}
	}
	return true;
}
//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~// Komanda
YCMD:kreirajpickup(playerid, params[], help) {
	if(!IsPlayerAdmin(playerid)) return SendClientMessage(playerid, -1, ""ORANGE"[!]: {FFFFFF}Samo Rcon Admini.");
    SPD(playerid, dialog_CREATEPICKUP, DIALOG_STYLE_INPUT, ""ORANGE"#CREATE_PICKUP", ""ORANGE"- {FFFFFF}U prazno polje ispod unesi id pickupa.", "Odaberi", "Izlaz");
	return true;
}
//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~// Cuvanje Pickupova
forward UcitajPickupove(pickup_id, name[], value[]);
public UcitajPickupove(pickup_id, name[], value[]) {
    INI_Int("PickupID", PickupInfo[pickup_id][pPickupID]);
	INI_Float("PickupX", PickupInfo[pickup_id][PickupX]);
	INI_Float("PickupY", PickupInfo[pickup_id][PickupY]);
	INI_Float("PickupZ", PickupInfo[pickup_id][PickupZ]);
	return true;
}
stock SacuvajPickupove(pickup_id) {
    new pFile[50];
	format(pFile, sizeof(pFile), PICKUPS_FILE, pickup_id);
	new INI:File = INI_Open(pFile);
	INI_WriteInt(File,"PickupID", PickupInfo[pickup_id][pPickupID]);
	INI_WriteFloat(File,"PickupX", PickupInfo[pickup_id][PickupX]);
	INI_WriteFloat(File,"PickupY", PickupInfo[pickup_id][PickupY]);
	INI_WriteFloat(File,"PickupZ", PickupInfo[pickup_id][PickupZ]);
	INI_Close(File);
	return true;
}
//~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~//