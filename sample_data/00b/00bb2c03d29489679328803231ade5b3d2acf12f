# In spec/factories/companies.rb
FactoryBot.define do
  factory :company do
    name { 'MyCompany' }
  end
end


# In spec/factories/users.rb
FactoryBot.define do
  company1 = FactoryBot.create(:company)  # this will be shared by several users

  factory :user1 do
    first_name { 'Joe' } 
    last_name { 'Smith' } 
    company_id { company1.id }
  end

  factory :user2 do
    first_name { 'Sam' } 
    last_name { 'Smith' } 
    company_id { company1.id }
  end
end
	
$ RAILS_ENV=test  bundle exec rake db:rebuild
rake aborted!
ActiveRecord::StatementInvalid: PG::UndefinedTable: ERROR:  relation "companies" does not exist
LINE 8:                WHERE a.attrelid = '"companies"'::regclass
                                          ^
:               SELECT a.attname, format_type(a.atttypid, a.atttypmod),
                     pg_get_expr(d.adbin, d.adrelid), a.attnotnull, a.atttypid, a.atttypmod,
                     c.collname, col_description(a.attrelid, a.attnum) AS comment
                FROM pg_attribute a
                LEFT JOIN pg_attrdef d ON a.attrelid = d.adrelid AND a.attnum = d.adnum
                LEFT JOIN pg_type t ON a.atttypid = t.oid
                LEFT JOIN pg_collation c ON a.attcollation = c.oid AND a.attcollation <> t.typcollation
               WHERE a.attrelid = '"companies"'::regclass
                 AND a.attnum > 0 AND NOT a.attisdropped
               ORDER BY a.attnum